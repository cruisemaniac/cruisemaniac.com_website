<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=twitter:card content="summary"><meta name=twitter:image content="https://cruisemaniac.com/images/avatar.jpg"><meta name=twitter:title content="Sassc nightmares with Docker"><meta name=twitter:description content="We run our infra on AWS Fargate. This means docker images. Our docker image is based on debian buster packaged with Ruby 2.6.5.
Of late, we&rsquo;ve had crashes on and off everytime the container boots up. They all have the same symptom: Rails tries to load the sassc gem and it barfs!
The biggest problem is the unpredictability of the crash. It might happen.
It might not!
If you run rails and make use of the sassc gem which you most probably will do, you might run into a problem when the gem is loaded:"><meta name=twitter:site content="@cruisemaniac"><meta name=twitter:creator content="@Ashwin M"><meta name=author content="Ashwin M"><meta name=description content="DevOps, Infra and Cloud Expert"><meta name=generator content="Hugo 0.77.0"><title>Sassc nightmares with Docker &#183; cruisemaniac.com</title><link href=https://fonts.googleapis.com rel=preconnect crossorigin=crossorigin><link href=https://fonts.gstatic.com rel=preconnect crossorigin=crossorigin><link href=https://www.google-analytics.com rel=preconnect crossorigin=crossorigin><link href=https://maxcdn.bootstrapcdn.com rel=preconnect crossorigin=crossorigin><link href=https://fonts.gstatic.com/s/notosans/v8/o-0IIpQlx3QUlC5A4PNr5TRASf6M7Q.woff2 rel=preload as=font crossorigin=crossorigin><link href=https://fonts.gstatic.com/s/dancingscript/v10/If2RXTr6YS-zF4S-kcSWSVi_szLgiuEHiC4W.woff2 rel=preload as=font crossorigin=crossorigin><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/fonts/fontawesome-webfont.woff2?v=4.7.0" rel=preload as=font crossorigin=crossorigin><link rel=stylesheet href=https://cruisemaniac.com/css/style.css><link rel=preload href=https://cruisemaniac.com/css/highlight.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cruisemaniac.com/css/highlight.css></noscript><link rel=preload href=https://cruisemaniac.com/css/font-awesome.min.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cruisemaniac.com/css/font-awesome.min.css></noscript><link href=https://cruisemaniac.com/index.xml rel=alternate type=application/rss+xml title=cruisemaniac.com><link rel=preload href=https://cruisemaniac.com/css/custom.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cruisemaniac.com/css/custom.css></noscript><link rel="shortcut icon" href=https://cruisemaniac.com/images/favicon.png></head><body><div id=page-container><section id=page-wrap><nav class=main-nav><a href=https://cruisemaniac.com/><span class=arrow>←</span>Home</a>
<a href=https://cruisemaniac.com/about>About</a>
<a href=https://cruisemaniac.com/tags>Tags</a>
<a href=https://cruisemaniac.com/projects-and-talks>Projects & Talks</a>
<a href=https://cruisemaniac.com/posts>Posts</a>
<a class=cta href=https://cruisemaniac.com/index.xml>RSS</a></nav><section id=wrapper class=post><article><header><h1>Sassc nightmares with Docker</h1><h2 class=headline>Feb 4, 2020 00:00
· 202 words
· 1 minute read
<span class=tags>|
<a href=https://cruisemaniac.com/tags/docker>docker</a> |
<a href=https://cruisemaniac.com/tags/rails>rails</a> |
<a href=https://cruisemaniac.com/tags/sassc>sassc</a> |
<a href=https://cruisemaniac.com/tags/rubygems>rubygems</a> |
<a href=https://cruisemaniac.com/tags/fargate>fargate</a> |</span></h2></header><section id=post-body><p>We run our infra on AWS Fargate. This means docker images. Our docker image is
based on debian buster packaged with Ruby 2.6.5.</p><p>Of late, we&rsquo;ve had crashes on and off everytime the container boots up. They all
have the same symptom: Rails tries to load the <code>sassc</code> gem and it barfs!</p><p>The biggest problem is the unpredictability of the crash. It might happen.</p><p>It might not!</p><p>If you run rails and make use of the <code>sassc</code> gem which you most probably will do,
you might run into a problem when the gem is loaded:</p><pre><code>/vendor/bundle/ruby/2.6.0/gems/ffi-1.11.1/lib/ffi/library.rb:112: [BUG] Illegal instruction at 0x00007f759d834a15
</code></pre><p>You&rsquo;ll see a nasty long thread dump and your app will fail to start.</p><p>This is caused by the 2.2.1 version of sassc where the portability between
processor architectures was removed post version 2.1.0.</p><p>There&rsquo;s two ways to fix this:</p><ul><li><p>Downgrade your gem from 2.2.1 to 2.1.0 until the team releases an official patch -
The <a href=https://github.com/sass/sassc-ruby/issues/146>bug</a> is still open and has been reported across multiple ruby versions.</p></li><li><p>Install the gem manually like so:</p></li></ul><pre><code>gem install sassc -- --disable-march-tune-native
</code></pre><p>The above step will cause a manual compile of the underlying libraries for the
gem and the problem goes away.</p><p>Happy rubying!</p></section></article><div class=row><div class=col><div class="newsletter row justify-content-center"><div class="col-lg-8 content"><p>If you'd like me to keep you posted:</p><link href=//cdn-images.mailchimp.com/embedcode/classic-10_7.css rel=stylesheet type=text/css><style type=text/css>#mc_embed_signup{background:#fff;clear:left;font:14px Helvetica,Arial,sans-serif}</style><div id=mc_embed_signup><form action="https://cruisemaniac.us8.list-manage.com/subscribe/post?u=d89d3ff810090855c61f96d04&id=53364f8a35" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=validate target=_blank novalidate><div id=mc_embed_signup_scroll><div class=indicates-required><span class=asterisk>*</span> indicates required</div><div class=mc-field-group><label for=mce-EMAIL>Email Address <span class=asterisk>*</span></label>
<input type=email name=EMAIL class="required email" id=mce-EMAIL></div><div class=mc-field-group><label for=mce-FNAME>Name</label>
<input type=text name=FNAME id=mce-FNAME></div><div id=mce-responses class=clear><div class=response id=mce-error-response style=display:none></div><div class=response id=mce-success-response style=display:none></div></div><div style=position:absolute;left:-5000px aria-hidden=true><input type=text name=b_d89d3ff810090855c61f96d04_53364f8a35 tabindex=-1></div><div class=clear><input type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe class=button></div></div></form></div></div></div></div></div></section></section><footer id=footer><div id=social><a class=symbol href=https://github.com/cruisemaniac aria-label=github-square alt="view github-square profile"><i class="fa fa-github-square"></i></a><a class=symbol href=https://linkedin.com/in/ashwinmurali aria-label=linkedin-square alt="view linkedin-square profile"><i class="fa fa-linkedin-square"></i></a><a class=symbol href=https://twitter.com/cruisemaniac aria-label=twitter-square alt="view twitter-square profile"><i class="fa fa-twitter-square"></i></a></div><p class=small>© 2020. Bangalore <i class="fa fa-heart" aria-hidden=true></i>|
Ashwin M</p></footer></div><script src=https://code.jquery.com/jquery-3.4.0.min.js integrity="sha256-BJeo0qm959uMBGb65z40ejJYGSgR7REI4+CW1fNKwOg=" crossorigin=anonymous></script><script src=https://cruisemaniac.com/js/main.js></script><script data-goatcounter=https://cruisemaniac.goatcounter.com/count async src=//gc.zgo.at/count.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>